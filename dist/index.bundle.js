(()=>{"use strict";const t=JSON.parse('{"type":0,"mapWidth":500,"mapHeight":500,"nodeWidth":100,"nodeHeight":50,"roadDataArr":[[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,1,0,0,0,0,1,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,1,0,0,0,0,1,0,0],[0,1,1,0,0,0,1,1,0,0],[0,1,0,1,0,0,1,0,1,0],[1,0,0,1,0,1,0,0,1,0],[0,1,0,1,0,0,1,0,1,0],[0,1,0,0,0,0,1,0,0,0],[0,0,1,0,0,0,0,1,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,1,0,1,0,0,1,0,1,0],[0,1,0,0,0,0,1,0,0,0],[0,0,1,0,0,0,0,1,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0]],"mapItem":[]}');var e=document.documentElement.clientWidth||document.body.clientWidth,o=document.documentElement.clientHeight||document.body.clientHeight,n=2880,i=1440,r=t.nodeWidth,s=t.nodeHeight;const a=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=0,this.y=0,this.x=t,this.y=e},c=function(){function t(){this._value=0,this._f=0,this._g=0,this._h=0,this._parent=null,this.ele=null}return t.prototype.toString2=function(){return"路点世界坐标：（"+this._cx+","+this._cy+"),  "+" g=".concat(this.g)+" h=".concat(this.h)+" f=".concat(this.f)},t.prototype.toString=function(){return"路点像素坐标：（"+this._px+","+this._py+"),  路点世界坐标：（"+this._cx+","+this._cy+"),  路点平面直角坐标：（"+this._dx+","+this._dy+")"},Object.defineProperty(t.prototype,"px",{get:function(){return this._px},set:function(t){this._px=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"py",{get:function(){return this._py},set:function(t){this._py=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cx",{get:function(){return this._cx},set:function(t){this._cx=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cy",{get:function(){return this._cy},set:function(t){this._cy=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dx",{get:function(){return this._dx},set:function(t){this._dx=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dy",{get:function(){return this._dy},set:function(t){this._dy=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){return this._value},set:function(t){this._value=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"f",{get:function(){return this._f},set:function(t){this._f=t,this.ele&&this.ele.resetText()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"g",{get:function(){return this._g},set:function(t){this._g=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"h",{get:function(){return this._h},set:function(t){this._h=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return this._parent},set:function(t){this._parent=t},enumerable:!1,configurable:!0}),t}();var h;!function(t){t[t.angle45=0]="angle45",t[t.angle90=1]="angle90",t[t.honeycomb=2]="honeycomb"}(h||(h={}));var l=function(){function t(){}return Object.defineProperty(t,"instance",{get:function(){return null==this._instance&&(this._instance=new t),this._instance},enumerable:!1,configurable:!0}),t.prototype.updateMapInfo=function(t,e,o,n,i){this._mapWidth=t,this._mapHeight=e,this._nodeWidth=o,this._nodeHeight=n,this._halfNodeWidth=Math.floor(this._nodeWidth/2),this._halfNodeHeight=Math.floor(this._nodeHeight/2),this._col=Math.ceil(t/this._nodeWidth),this._row=Math.ceil(e/this._nodeHeight),this._mapType=i,this._mapType===h.angle45&&(this._mapRoad=new u(this._row,this._col,this._nodeWidth,this._nodeHeight,this._halfNodeWidth,this._halfNodeHeight))},t.prototype.getNodeByPixel=function(t,e){return this._mapRoad?this._mapRoad.getNodeByPixel(t,e):new c},t.prototype.getNodeByDerect=function(t,e){return this._mapRoad?this._mapRoad.getNodeByDerect(t,e):new c},t.prototype.getNodeByWorldPoint=function(t,e){return this._mapRoad?this._mapRoad.getNodeByWorldPoint(t,e):new c},t.prototype.getWorldPointByPixel=function(t,e){return this._mapRoad?this._mapRoad.getWorldPointByPixel(t,e):new a},t.prototype.getPixelByWorldPoint=function(t,e){return this._mapRoad?this._mapRoad.getPixelByWorldPoint(t,e):new a},t.prototype.getDerectByPixel=function(t,e){return this._mapRoad?this._mapRoad.getDerectByPixel(t,e):new a},t.prototype.getDerectByWorldPoint=function(t,e){return this._mapRoad?this._mapRoad.getDerectByWorldPoint(t,e):new a},t.prototype.getPixelByDerect=function(t,e){return this._mapRoad?this._mapRoad.getPixelByDerect(t,e):new a},Object.defineProperty(t.prototype,"mapWidth",{get:function(){return this._mapWidth},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mapHeight",{get:function(){return this._mapHeight},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"nodeWidth",{get:function(){return this._nodeWidth},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"nodeHeight",{get:function(){return this._nodeHeight},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"row",{get:function(){return this._row},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"col",{get:function(){return this._col},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"halfNodeWidth",{get:function(){return this._halfNodeWidth},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"halfNodeHeight",{get:function(){return this._halfNodeHeight},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mapType",{get:function(){return this._mapType},enumerable:!1,configurable:!0}),t}();const d=l;var u=function(){function t(t,e,o,n,i,r){this._row=t,this._col=e,this._nodeWidth=o,this._nodeHeight=n,this._halfNodeWidth=i,this._halfNodeHeight=r}return t.prototype.getNodeByPixel=function(t,e){var o=this.getWorldPointByPixel(t,e),n=this.getPixelByWorldPoint(o.x,o.y),i=this.getDerectByPixel(t,e),r=new c;return r.cx=o.x,r.cy=o.y,r.px=n.x,r.py=n.y,r.dx=i.x,r.dy=i.y,r},t.prototype.getNodeByDerect=function(t,e){var o=this.getPixelByDerect(t,e),n=this.getWorldPointByPixel(o.x,o.y),i=new c;return i.cx=n.x,i.cy=n.y,i.px=o.x,i.py=o.y,i.dx=t,i.dy=e,i},t.prototype.getNodeByWorldPoint=function(t,e){var o=this.getPixelByWorldPoint(t,e);return this.getNodeByPixel(o.x,o.y)},t.prototype.getWorldPointByPixel=function(t,e){var o=Math.ceil(t/this._nodeWidth-.5+e/this._nodeHeight)-1,n=this._col-1-Math.ceil(t/this._nodeWidth-.5-e/this._nodeHeight);return new a(o,n)},t.prototype.getPixelByWorldPoint=function(t,e){var o=Math.floor((t+1-(e-(this._col-1)))*this._halfNodeWidth),n=Math.floor((t+1+(e-(this._col-1)))*this._halfNodeHeight);return new a(o,n)},t.prototype.getDerectByPixel=function(t,e){var o=this.getWorldPointByPixel(t,e),n=this.getPixelByWorldPoint(o.x,o.y),i=Math.floor(n.x/this._nodeWidth)-(n.x%this._nodeWidth==0?1:0),r=Math.floor(n.y/this._halfNodeHeight)-1;return new a(i,r)},t.prototype.getDerectByWorldPoint=function(t,e){var o=Math.floor((t-(e-(this._col-1)))/2),n=t+(e-(this._col-1));return new a(o,n)},t.prototype.getPixelByDerect=function(t,e){var o=Math.floor((t+e%2)*this._nodeWidth+(1-e%2)*this._halfNodeWidth),n=Math.floor((e+1)*this._halfNodeHeight);return new a(o,n)},t}();const p=function(){function t(t){this.COST_STRAIGHT=10,this.COST_DIAGONAL=14,this.maxStep=1e3,this._round=[[0,-1,10],[1,-1,14],[1,0,10],[1,1,14],[0,1,10],[-1,1,14],[-1,0,10],[-1,-1,14]],this.handle=-1,this.optimize=!0,this._roadNodes=t}return t.prototype.resetText=function(){for(var t in this._roadNodes)this._roadNodes[t].ele.htxt.visible=!1},t.prototype.seekPath=function(t,e){if(this._startNode=t,this._currentNode=t,this._targetNode=e,!this._startNode||!this._targetNode)return[];if(console.log("from: ".concat(t.cx,",").concat(t.cy)," to: ".concat(e.cx,",").concat(e.cy)),1===this._targetNode.value)return console.log("目标不可达到："),[];this._openlist=[],this._closelist=[];for(var o=0;;){if(o>this.maxStep)return console.log("没找到目标计算步骤为：",o),[];if(o++,this.searchRoundNodes(this._currentNode),0==this._openlist.length)return console.log("没找到目标计算步骤为：",o),[];if(this._openlist.sort(this.sortNode),this._currentNode=this._openlist.shift(),this._currentNode==this._targetNode)return console.log("找到目标计算步骤为：",o),this.getPath();this._closelist.push(this._currentNode)}return[]},t.prototype.seekPath2=function(t,e){if(this._startNode=t,this._currentNode=t,this._targetNode=e,!this._startNode||!this._targetNode)return[];console.log("from:(".concat(t.cx,",").concat(t.cy,")")," to:(".concat(e.cx,",").concat(e.cy,")")),this.resetText(),this._openlist=[],this._closelist=[];for(var o=0,n=null;;){if(o>this.maxStep)return console.log("没找到目标计算步骤为：",o),this.seekPath(t,n);if(o++,this.searchRoundNodes(this._currentNode),0==this._openlist.length)return console.log("没找到目标计算步骤为：",o),this.seekPath(t,n);if(this._openlist.sort(this.sortNode),this._currentNode=this._openlist.shift(),(null==n||this._currentNode.h<n.h)&&(n=this._currentNode),this._currentNode==this._targetNode)return console.log("找到目标计算步骤为：",o),this.getPath();this._closelist.push(this._currentNode)}return this.seekPath(t,n)},t.prototype.sortNode=function(t,e){return t.f<e.f?-1:t.f>e.f?1:0},t.prototype.getPath=function(){for(var t=[],e=this._targetNode;e!=this._startNode;)t.unshift(e),e=e.parent;if(t.unshift(this._startNode),!this.optimize)return t;for(var o=1;o<t.length-1;o++){var n=t[o-1],i=t[o],r=t[o+1],s=i.cx==n.cx&&i.cx==r.cx,a=i.cy==n.cy&&i.cy==r.cy,c=(i.cx-n.cx)/(i.cy-n.cy)*((r.cx-i.cx)/(r.cy-i.cy))==1;(s||a||c)&&(t.splice(o,1),o--)}for(o=0;o<t.length-2;o++){for(var h=t[o],l=null,d=t.length-1;d>o+1;d--){var u=t[d];if(h.cx!=u.cx&&h.cy!=u.cy&&Math.abs(u.cx-h.cx)!=Math.abs(u.cy-h.cy)&&this.isArriveBetweenTwoNodes(h,u)){l=u;break}}if(l){var p=d-o-1;t.splice(o+1,p)}}return t},t.prototype.isArriveBetweenTwoNodes=function(t,e){if(t==e)return!1;var o=Math.abs(e.cx-t.cx),n=Math.abs(e.cy-t.cy),i=0;e.cx>t.cx?i=1:e.cx<t.cx&&(i=-1);var r=0;e.cy>t.cy?r=1:e.cy<t.cy&&(r=-1);var s=0,a=0,c=0,h=0;if(o>n)for(var l=n/o,d=0;d<o;d++){a=t.cy+d*r*l,c=Math.floor(a),h=a%1;var u=t.cx+d*i,p=h<=.5?c:c+1;a=t.cy+(d+1)*r*l,c=Math.floor(a),h=a%1;var f=t.cx+(d+1)*i,y=h<=.5?c:c+1,_=this._roadNodes[u+"_"+p],g=this._roadNodes[f+"_"+y];if(!this.isCrossAtAdjacentNodes(_,g))return!1}else for(l=o/n,d=0;d<n;d++)if(s=d*i*l,c=i>0?Math.floor(t.cx+s):Math.ceil(t.cx+s),u=(h=Math.abs(s%1))<=.5?c:c+1*i,p=t.cy+d*r,s=(d+1)*i*l,c=i>0?Math.floor(t.cx+s):Math.ceil(t.cx+s),f=(h=Math.abs(s%1))<=.5?c:c+1*i,y=t.cy+(d+1)*r,_=this._roadNodes[u+"_"+p],g=this._roadNodes[f+"_"+y],!this.isCrossAtAdjacentNodes(_,g))return!1;return!0},t.prototype.isCrossAtAdjacentNodes=function(t,e){if(t==e)return!1;if(!this.isPassNode(t)||!this.isPassNode(e))return!1;var o=e.cx-t.cx,n=e.cy-t.cy;return!(Math.abs(o)>1||Math.abs(n)>1||t.cx!=e.cx&&t.cy!=e.cy&&(!this.isPassNode(this._roadNodes[t.cx+"_"+(t.cy+n)])||!this.isPassNode(this._roadNodes[t.cx+o+"_"+t.cy])))},t.prototype.isPassNode=function(t){return!(!t||1==t.value)},t.prototype.testSeekPathStep=function(t,e,o,n,i){var r=this;if(void 0===i&&(i=100),this._startNode=t,this._currentNode=t,this._targetNode=e,1!=this._targetNode.value){this._openlist=[],this._closelist=[];var s=0;clearInterval(this.handle),this.handle=setInterval((function(){return s>r.maxStep?(console.log("没找到目标计算步骤为：",s),void clearInterval(r.handle)):(s++,r.searchRoundNodes(r._currentNode),0==r._openlist.length?(console.log("没找到目标计算步骤为：",s),void clearInterval(r.handle)):(r._openlist.sort(r.sortNode),r._currentNode=r._openlist.shift(),void(r._currentNode==r._targetNode?(console.log("找到目标计算步骤为：",s),clearInterval(r.handle),o.apply(n,[r._startNode,r._targetNode,r._currentNode,r._openlist,r._closelist,r.getPath()])):(r._closelist.push(r._currentNode),o.apply(n,[r._startNode,r._targetNode,r._currentNode,r._openlist,r._closelist,null])))))}),i)}},t.prototype.searchRoundNodes=function(t){var e=this;this._round.forEach((function(o,n){var i=o[0],r=o[1],s=(o[2],t.cx+i),a=t.cy+r,c=e._roadNodes[s+"_"+a];null==c||c==e._startNode||1===c.value||e.isInCloseList(c)||e.isInCorner(c)||e.setNodeF(c)}))},t.prototype.setNodeF=function(t){var e;if(e=t.cx==this._currentNode.cx||t.cy==this._currentNode.cy?this._currentNode.g+this.COST_STRAIGHT:this._currentNode.g+this.COST_DIAGONAL,this.isInOpenList(t)){if(!(e<t.g))return;t.g=e}else t.g=e,this._openlist.push(t);t.h=(Math.abs(this._targetNode.cx-t.cx)+Math.abs(this._targetNode.cy-t.cy))*this.COST_STRAIGHT,t.f=t.g+t.h,t.parent=this._currentNode},t.prototype.isInOpenList=function(t){return-1!=this._openlist.indexOf(t)},t.prototype.isInCloseList=function(t){return-1!=this._closelist.indexOf(t)},t.prototype.isInCorner=function(t){if(t.cx==this._currentNode.cx||t.cy==this._currentNode.cy)return!1;var e=this._roadNodes[this._currentNode.cx+"_"+t.cy],o=this._roadNodes[t.cx+"_"+this._currentNode.cy];return!this.isPassNode(e)||!this.isPassNode(o)},t.prototype.dispose=function(){this._roadNodes=null,this._round=null},t}();var f,y=(f=function(t,e){return f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},f(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=t}f(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});const _=function(t){function e(){var e=t.call(this)||this,o=new PIXI.Loader;return o.add("spritesheet","./static/assets/mc.json"),o.once("complete",e.onLoadComplete.bind(e)),o.load(),e}return y(e,t),e.prototype.onLoadComplete=function(){for(var t=this,e=[],o=1;o<=64;o++){var n=PIXI.Texture.from("Explosion_Sequence_A ".concat(o,".png"));e.push(n)}var i=this.player=new PIXI.AnimatedSprite(e);i.onFrameChange=function(){var e=i.currentFrame;(e>t.endFrame||56===t.startFrame&&0===e)&&i.gotoAndPlay(t.startFrame)},i.x=0,i.y=0,i.anchor.set(.5,.65625),i.gotoAndStop(49),i.animationSpeed=.2,this.addChild(i),this.x=350,this.y=125;var r=new PIXI.Graphics;r.beginFill(14561865),r.drawRect(0,0,5,5),r.endFill(),this.addChild(r)},e.prototype.play=function(t){(t=(t+360)%360)<=202.5&&t>157.5?(this.startFrame=0,this.endFrame=7):t<=247.5&&t>202.5?(this.startFrame=8,this.endFrame=15):t<=292.5&&t>247.5?(this.startFrame=16,this.endFrame=23):t<=337.5&&t>292.5?(this.startFrame=24,this.endFrame=31):t<=22.5||t>337.5?(this.startFrame=32,this.endFrame=39):t<=67.5&&t>22.5?(this.startFrame=40,this.endFrame=47):t<=112.5&&t>67.5?(this.startFrame=48,this.endFrame=55):t<=157.5&&t>112.5&&(this.startFrame=56,this.endFrame=63),this.player.gotoAndPlay(this.startFrame)},e.prototype.stop=function(){this.player.gotoAndStop(this.startFrame)},e}(PIXI.Container);var g=function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();const x=function(t){function e(){var e=t.call(this)||this,o=null;e.interactive=!0,e.on("pointerdown",(function(t){o={x:t.data.global.x,y:t.data.global.y}})),e.on("pointerup",(function(t){if(o){var n=o.x,i=o.y,r={x:t.data.global.x,y:t.data.global.y},s=r.x,a=r.y;Math.sqrt((s-n)*(s-n)+(a-i)*(a-i))<1&&e.emit("click_map",t.data.getLocalPosition(e.parent))}o=null}));var r=new PIXI.Sprite.from("./static/assets/s1/s1_min.jpg");e.addChild(r),r.scale.set(n/r.texture.width,i/r.texture.height),e._waitLoadZone=[],e._sliceRows=6,e._sliceCols=8,e._sliceWidth=360,e._sliceHeight=240;for(var s=0;s<e._sliceRows;s++)for(var a=0;a<e._sliceCols;a++){var c="s1_"+s+"_"+(a+1)+".png";e._waitLoadZone.push([c,s,a])}return e.load(),e}return g(e,t),e.prototype.load=function(){var t=this;if(this._waitLoadZone.length){var e=this._waitLoadZone.shift(),o=e[0],n=e[1],i=e[2],r="./static/assets/s1/360*240/"+o,s=new PIXI.Loader;s.add(r),s.once("complete",(function(){t.drawBGMap(r,n,i),t.load()})),s.load()}},e.prototype.drawBGMap=function(t,e,o){var n=this._sliceWidth*o,i=this._sliceHeight*e,r=new PIXI.Sprite.from(t);this.addChildAt(r,1),r.position.set(n,i)},e.prototype.drawNode=function(t){var e=new m(t);this.addChild(e),t.ele=e},e}(PIXI.Container);var m=function(t){function e(e){var o=t.call(this)||this;o.node=e;var n=e.cx,i=e.cy,s=e.dx,a=e.dy,c=e.px,h=e.py,l=e.value;o.x=c,o.y=h;var d=r;o.bg=new PIXI.Graphics,o.addChild(o.bg),o.setBGColor(0===l?32768:16711680,0===l?.5:1);var u=new PIXI.Graphics;u.beginFill(16777215,1),u.drawCircle(0,0,2),u.endFill(),o.addChild(u);var p={fontSize:12,fill:16777215,align:"center"},f=new PIXI.Text("".concat(s,"/").concat(a),p);o.addChild(f),f.anchor.set(.5,.5),f.x=0,f.y=0,f.angle=26.56505117707799;var y=new PIXI.Text("".concat(n,"/").concat(i),p);y.anchor.set(1,0),o.addChild(y),y.x=d/2-3,y.y=-3,y.angle=26.56505117707799;var _=new PIXI.Text("".concat(n,"/").concat(i),p);return o.addChild(_),_.anchor.set(0,1),_.x=-d/2+7,_.y=2,_.angle=26.56505117707799,_.visible=!1,o.htxt=_,o}return g(e,t),e.prototype.resetText=function(){this.htxt.visible=!0,this.htxt.text="".concat(this.node.g,",").concat(this.node.h,",").concat(this.node.f)},e.prototype.setBGColor=function(t,e){var o=r,n=s,i=this.bg;return i.clear(),i.beginFill(t,e),i.lineStyle(1,16777215,.3),i.moveTo(-o/2,0),i.lineTo(0,-n/2),i.lineTo(o/2,0),i.lineTo(0,n/2),i.closePath(),i.endFill(),this},e.prototype.resetBg=function(){var t=this.node.value;this.setBGColor(0===t?32768:16711680,0===t?.5:1)},e}(PIXI.Container),v=function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();console.log("mapdata8:",t);const b=function(e){function o(){var t=e.call(this)||this;return t._roadDic={},t.roadNodeArr=[],t.init(),t}return v(o,e),o.prototype.init=function(){var e=this;this.sceneMap=new x,this.addChild(this.sceneMap),this.player=new _,this.addChild(this.player),d.instance.updateMapInfo(t.mapWidth,t.mapHeight,t.nodeWidth,t.nodeHeight,t.type);for(var o=t.roadDataArr.length,n=t.roadDataArr[0].length,i=0;i<o;i++)for(var r=0;r<n;r++){var s=d.instance.getNodeByDerect(r,i);s.value=t.roadDataArr[i][r],this._roadDic[s.cx+"_"+s.cy]=s,i<200&&r<200&&this.sceneMap.drawNode(s)}this._roadSeeker=new p(this._roadDic),this.sceneMap.on("click_map",(function(t){e.startNode&&e.startNode.resetBg(),e.targetNode&&e.targetNode.resetBg(),console.log("click map",t);var o=t.x,n=t.y,i=d.instance.getWorldPointByPixel(e.player.x,e.player.y),r=d.instance.getWorldPointByPixel(o,n),s=e._roadDic[i.x+"_"+i.y],a=e._roadDic[r.x+"_"+r.y];console.log(s,a);var c=e._roadSeeker.seekPath2(s,a);console.log(c),c.length>=2&&(e.startNode=c[0].ele.setBGColor(0,.5),e.targetNode=c[c.length-1].ele.setBGColor(16777215,.5));var h=window.TweenMax.getTweensOf(e.player);h&&h.length&&h[0].kill(),e.roadNodeArr=c,e.move()}))},o.prototype.move=function(){if(this.roadNodeArr&&this.roadNodeArr.length>0){var t=this.roadNodeArr.shift();console.log(t.toString());var e=t.px-this.player.x,o=t.py-this.player.y,n=180/Math.PI*Math.atan2(o,e);this.player.play(n);var i=Math.sqrt(e*e+o*o),r=Math.abs(i)/100*1;window.TweenMax.to(this.player,r,{x:t.px,y:t.py,ease:window.Power0.easeNone,onComplete:this.move.bind(this)})}else this.player.stop()},o}(PIXI.Container);var P=function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();const N=function(t){function e(e){var o=t.call(this)||this;o.$config=Object.assign({},e);var n=new PIXI.Sprite.from("./static/assets/minus.png");o.addChild(n),n.scale.set(.5),n.buttonMode=!0,n.interactive=!0,n.on("pointerdown",(function(t){o.ratio-=.1,o.$config.update&&o.$config.update(o._ratio),t.stopPropagation()}));var i=new PIXI.Text("",{fontFamily:"Arial",fontSize:16,fill:16777215,align:"center"});i.anchor.set(.5),o.addChild(i),i.x=52.5,i.y=12.5,o.text=i;var r=new PIXI.Sprite.from("./static/assets/plus.png");return o.addChild(r),r.scale.set(.5),r.buttonMode=!0,r.x=80,r.interactive=!0,r.on("pointerdown",(function(t){o.ratio+=.1,o.$config.update&&o.$config.update(o._ratio),t.stopPropagation()})),o.ratio=o.$config.ratio||1,o}return P(e,t),Object.defineProperty(e.prototype,"ratio",{get:function(){return this._ratio},set:function(t){t<=this.$config.minScale?t=this.$config.minScale:t>=this.$config.maxScale&&(t=this.$config.maxScale),this._ratio=t,this.text.text=parseInt(100*this._ratio)+"%"},enumerable:!1,configurable:!0}),e}(PIXI.Container);var w=function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();const O=function(t){function r(e){void 0===e&&(e={});var o=t.call(this,e)||this;return o.init(),o}return w(r,t),r.prototype.init=function(){document.body.prepend(this.view);var t=Math.max(e/n,o/i),r=new b;this.stage.addChild(r),r.scale.set(1);var s=new N({ratio:r.scale.x,minScale:t,maxScale:2,update:function(t){var r=c.value;c.value=t,c.calculatePosition(r,c.value,e/2,o/2),a.contentWidth=n*t,a.contentHeight=i*t}});this.stage.addChild(s),s.x=e-120,s.y=10,new W({ele:r,width:n,height:i});var a=new I({content:r,maskWidth:e,maskHeight:o,contentWidth:2880,contentHeight:1440}),c=new M({ele:r,value:1,minZoom:t,maxZoom:2,update:function(t){s.ratio=t,a.contentWidth=n*t,a.contentHeight=i*t}})},r}(PIXI.Application);var W=function(){function t(t){var e=(this.config=t).ele;this.ele=e,this.ele.interactive=!0,this.ele.on("pointerdown",this.onDragStart,this)}return t.prototype.onDragStart=function(t){var e=t.data.global,o=e.x,n=e.y;this.dragging=!0,this.offset={x:this.ele.x-o,y:this.ele.y-n},this.ele.on("pointerup",this.onDragEnd,this),this.ele.on("pointerupoutside",this.onDragEnd,this),this.ele.on("pointermove",this.onDragMove,this)},t.prototype.onDragEnd=function(){this.dragging=!1,this.offset=null,this.ele.off("pointerup",this.onDragEnd,this).off("pointerupoutside",this.onDragEnd,this).off("pointermove",this.onDragMove,this)},t.prototype.onDragMove=function(t){if(this.dragging){var r=t.data.global,s=r.x,a=r.y,c=s+this.offset.x;c=c>=0?0:c<=-(n*this.ele.scale.x-e)?-(n*this.ele.scale.x-e):c;var h=a+this.offset.y;h=h>=0?0:h<=-(i*this.ele.scale.y-o)?-(i*this.ele.scale.y-o):h,this.ele.x=c,this.ele.y=h}},t}(),I=function(){function t(t){var e=this._options=t,o=e.content,n=e.maskWidth,i=e.maskHeight,r=e.contentWidth,s=e.contentHeight;this._content=o,this._maskWidth=n,this._maskHeight=i,this._contentWidth=r,this._contentHeight=s,this._deceleration=.001,this._content.on("pointerdown",this.onPointerDownListener,this)}return t.prototype.onPointerDownListener=function(){var t=window.TweenMax.getTweensOf(this._content);t.length&&t[0].kill(),this._start={time:(new Date).getTime(),x:this._content.x,y:this._content.y},this._content.on("pointerup",this.onPointerUpListener,this),this._content.on("pointerout",this.onPointerOutListener,this)},t.prototype.onPointerUpListener=function(){if(this._start){var t=(new Date).getTime()-this._start.time,e=this.momentum(this._content.x,this._start.x,t,this.maxScrollLeft,0,this._deceleration),o=this.momentum(this._content.y,this._start.y,t,this.maxScrollTop,0,this._deceleration),n=e.destination,i=o.destination,r=Math.max(e.duration,o.duration),s={x:n,y:i,ease:window.Power2.easeOut,onUpdate:function(){},onComplete:function(){}};window.TweenMax.to(this._content,r/1e3,s)}this._content.off("pointerup",this.onPointerUpListener,this),this._content.off("pointerout",this.onPointerOutListener,this)},t.prototype.onPointerOutListener=function(){this.onPointerUpListener()},t.prototype.momentum=function(t,e,o,n,i,r){void 0===r&&(r=6e-4);var s,a,c,h=t-e,l=Math.abs(h)/o;return a=l/r,(s=t+(l*(c=(0-l)/r)+.5*r*c*c)*(h>0?-1:1))<n?(s=i?n-i/2.5*(l/8):n,a=(h=Math.abs(s-t))/l):s>0&&(s=i?i/2.5*(l/8):0,a=(h=Math.abs(t)+s)/l),{destination:Math.round(s),duration:a}},Object.defineProperty(t.prototype,"contentWidth",{set:function(t){this._contentWidth=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"contentHeight",{set:function(t){this._contentHeight=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"maxScrollLeft",{get:function(){return this._maskWidth-this._contentWidth},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"maxScrollTop",{get:function(){return this._maskHeight-this._contentHeight},enumerable:!1,configurable:!0}),t}(),M=function(){function t(e){var o=this.$config=Object.assign({},t.defaultConfig,e),n=o.ele,i=o.value;this.ele=n,this.value=i,this.onMouseWheel=this.onMouseWheel.bind(this),document.addEventListener("mousewheel",this.onMouseWheel,{passive:!1})}return t.prototype.onMouseWheel=function(t){this.zoom(t),t.preventDefault()},t.prototype.zoom=function(t){var e=this.$config,o=e.speed,n=e.minZoom,i=e.maxZoom,r=this.value,s=t.wheelDelta<=0?r-o:r+o;s>=i?s=i:s<=n&&(s=n),this.value=s,this.$config.update&&this.$config.update(this.value),this.calculatePosition(r,s,t.clientX,t.clientY)},t.prototype.calculatePosition=function(t,e,o,n){var i=e/t;this.x*=i,this.y*=i,this.x-=(i-1)*o,this.y-=(i-1)*n},Object.defineProperty(t.prototype,"value",{get:function(){return this.ele.scale.x},set:function(t){t=t>this.$config.maxZoom?this.$config.maxZoom:t<this.$config.minZoom?this.$config.minZoom:t,this.ele.scale.set(t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"x",{get:function(){return this.ele.x},set:function(t){t=t>=0?0:t<=-(n*this.value-e)?-(n*this.value-e):t,this.ele.x=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this.ele.y},set:function(t){t=t>=0?0:t<=-(i*this.value-o)?-(i*this.value-o):t,this.ele.y=t},enumerable:!1,configurable:!0}),t.prototype.destroy=function(){document.removeEventListener("mousewheel",this.onMouseWheel)},t.defaultConfig={x:0,y:0,value:1,speed:.2,minScale:.5,maxScale:2},t}();new O({width:e,height:o,backgroundColor:13421772})})();