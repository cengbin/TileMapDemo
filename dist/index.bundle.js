(()=>{"use strict";const t=JSON.parse('{"name":"mapData","bgName":"37502319-9924-4436-bd93-a6cc58684486","type":0,"mapWidth":2450,"mapHeight":1775,"nodeWidth":100,"nodeHeight":50,"roadDataArr":[[0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,1,1,1,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,1,1,1,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,1,1,1,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,1,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,1,1,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,1,1,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,1,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,1,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,1,1,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,1,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,1,1,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,1,1,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,1,1,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,1,1,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,1,1,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,1,1,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]],"mapItem":[]}'),e=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=0,this.y=0,this.x=t,this.y=e},o=function(){function t(){this._value=0,this._f=0,this._g=0,this._h=0,this._parent=null}return t.prototype.toString=function(){return"路点像素坐标：（"+this._px+","+this._py+"),  路点世界坐标：（"+this._cx+","+this._cy+"),  路点平面直角坐标：（"+this._dx+","+this._dy+")"},Object.defineProperty(t.prototype,"px",{get:function(){return this._px},set:function(t){this._px=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"py",{get:function(){return this._py},set:function(t){this._py=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cx",{get:function(){return this._cx},set:function(t){this._cx=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cy",{get:function(){return this._cy},set:function(t){this._cy=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dx",{get:function(){return this._dx},set:function(t){this._dx=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dy",{get:function(){return this._dy},set:function(t){this._dy=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){return this._value},set:function(t){this._value=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"f",{get:function(){return this._f},set:function(t){this._f=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"g",{get:function(){return this._g},set:function(t){this._g=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"h",{get:function(){return this._h},set:function(t){this._h=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return this._parent},set:function(t){this._parent=t},enumerable:!1,configurable:!0}),t}();var i;!function(t){t[t.angle45=0]="angle45",t[t.angle90=1]="angle90",t[t.honeycomb=2]="honeycomb"}(i||(i={}));const n=function(){function t(){}return Object.defineProperty(t,"instance",{get:function(){return null==this._instance&&(this._instance=new t),this._instance},enumerable:!1,configurable:!0}),t.prototype.updateMapInfo=function(t,e,o,n,s){this._mapWidth=t,this._mapHeight=e,this._nodeWidth=o,this._nodeHeight=n,this._halfNodeWidth=Math.floor(this._nodeWidth/2),this._halfNodeHeight=Math.floor(this._nodeHeight/2),this._col=Math.ceil(t/this._nodeWidth),this._row=Math.ceil(e/this._nodeHeight),this._mapType=s,this._mapType===i.angle45&&(this._mapRoad=new r(this._row,this._col,this._nodeWidth,this._nodeHeight,this._halfNodeWidth,this._halfNodeHeight))},t.prototype.getNodeByPixel=function(t,e){return this._mapRoad?this._mapRoad.getNodeByPixel(t,e):new o},t.prototype.getNodeByDerect=function(t,e){return this._mapRoad?this._mapRoad.getNodeByDerect(t,e):new o},t.prototype.getNodeByWorldPoint=function(t,e){return this._mapRoad?this._mapRoad.getNodeByWorldPoint(t,e):new o},t.prototype.getWorldPointByPixel=function(t,o){return this._mapRoad?this._mapRoad.getWorldPointByPixel(t,o):new e},t.prototype.getPixelByWorldPoint=function(t,o){return this._mapRoad?this._mapRoad.getPixelByWorldPoint(t,o):new e},t.prototype.getDerectByPixel=function(t,o){return this._mapRoad?this._mapRoad.getDerectByPixel(t,o):new e},t.prototype.getDerectByWorldPoint=function(t,o){return this._mapRoad?this._mapRoad.getDerectByWorldPoint(t,o):new e},t.prototype.getPixelByDerect=function(t,o){return this._mapRoad?this._mapRoad.getPixelByDerect(t,o):new e},Object.defineProperty(t.prototype,"mapWidth",{get:function(){return this._mapWidth},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mapHeight",{get:function(){return this._mapHeight},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"nodeWidth",{get:function(){return this._nodeWidth},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"nodeHeight",{get:function(){return this._nodeHeight},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"row",{get:function(){return this._row},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"col",{get:function(){return this._col},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"halfNodeWidth",{get:function(){return this._halfNodeWidth},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"halfNodeHeight",{get:function(){return this._halfNodeHeight},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mapType",{get:function(){return this._mapType},enumerable:!1,configurable:!0}),t}();var r=function(){function t(t,e,o,i,n,r){this._row=t,this._col=e,this._nodeWidth=o,this._nodeHeight=i,this._halfNodeWidth=n,this._halfNodeHeight=r}return t.prototype.getNodeByPixel=function(t,e){var i=this.getWorldPointByPixel(t,e),n=this.getPixelByWorldPoint(i.x,i.y),r=this.getDerectByPixel(t,e),s=new o;return s.cx=i.x,s.cy=i.y,s.px=n.x,s.py=n.y,s.dx=r.x,s.dy=r.y,s},t.prototype.getNodeByDerect=function(t,e){var i=this.getPixelByDerect(t,e),n=this.getWorldPointByPixel(i.x,i.y),r=new o;return r.cx=n.x,r.cy=n.y,r.px=i.x,r.py=i.y,r.dx=t,r.dy=e,r},t.prototype.getNodeByWorldPoint=function(t,e){var o=this.getPixelByWorldPoint(t,e);return this.getNodeByPixel(o.x,o.y)},t.prototype.getWorldPointByPixel=function(t,o){var i=Math.ceil(t/this._nodeWidth-.5+o/this._nodeHeight)-1,n=this._col-1-Math.ceil(t/this._nodeWidth-.5-o/this._nodeHeight)-1;return new e(i,n)},t.prototype.getPixelByWorldPoint=function(t,o){var i=Math.floor((t+1-(o-(this._col-1)))*this._halfNodeWidth),n=Math.floor((t+1+(o-(this._col-1)))*this._halfNodeHeight);return new e(i,n)},t.prototype.getDerectByPixel=function(t,o){var i=this.getWorldPointByPixel(t,o),n=this.getPixelByWorldPoint(i.x,i.y),r=Math.floor(n.x/this._nodeWidth)-(n.x%this._nodeWidth==0?1:0),s=Math.floor(n.y/this._halfNodeHeight)-1;return new e(r,s)},t.prototype.getDerectByWorldPoint=function(t,o){var i=Math.floor((t-(o-(this._col-1)))/2),n=t+(o-(this._col-1));return new e(i,n)},t.prototype.getPixelByDerect=function(t,o){var i=Math.floor((t+o%2)*this._nodeWidth+(1-o%2)*this._halfNodeWidth),n=Math.floor((o+1)*this._halfNodeHeight);return new e(i,n)},t}();const s=function(){function t(t){this.COST_STRAIGHT=10,this.COST_DIAGONAL=14,this.maxStep=1e3,this._round=[[0,-1],[1,-1],[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1]],this.handle=-1,this.optimize=!0,this._roadNodes=t}return t.prototype.seekPath=function(t,e){if(this._startNode=t,this._currentNode=t,this._targetNode=e,!this._startNode||!this._targetNode)return[];if(1==this._targetNode.value)return console.log("目标不可达到："),[];this._openlist=[],this._closelist=[];for(var o=0;;){if(o>this.maxStep)return console.log("没找到目标计算步骤为：",o),[];if(o++,this.searchRoundNodes(this._currentNode),0==this._openlist.length)return console.log("没找到目标计算步骤为：",o),[];if(this._openlist.sort(this.sortNode),this._currentNode=this._openlist.shift(),this._currentNode==this._targetNode)return console.log("找到目标计算步骤为：",o),this.getPath();this._closelist.push(this._currentNode)}return[]},t.prototype.seekPath2=function(t,e){if(this._startNode=t,this._currentNode=t,this._targetNode=e,!this._startNode||!this._targetNode)return[];this._openlist=[],this._closelist=[];for(var o=0,i=null;;){if(o>this.maxStep)return console.log("没找到目标计算步骤为：",o),this.seekPath(t,i);if(o++,this.searchRoundNodes(this._currentNode),0==this._openlist.length)return console.log("没找到目标计算步骤为：",o),this.seekPath(t,i);if(this._openlist.sort(this.sortNode),this._currentNode=this._openlist.shift(),(null==i||this._currentNode.h<i.h)&&(i=this._currentNode),this._currentNode==this._targetNode)return console.log("找到目标计算步骤为：",o),this.getPath();this._closelist.push(this._currentNode)}return this.seekPath(t,i)},t.prototype.sortNode=function(t,e){return t.f<e.f?-1:t.f>e.f?1:0},t.prototype.getPath=function(){for(var t=[],e=this._targetNode;e!=this._startNode;)t.unshift(e),e=e.parent;if(t.unshift(this._startNode),!this.optimize)return t;for(var o=1;o<t.length-1;o++){var i=t[o-1],n=t[o],r=t[o+1],s=n.cx==i.cx&&n.cx==r.cx,h=n.cy==i.cy&&n.cy==r.cy,a=(n.cx-i.cx)/(n.cy-i.cy)*((r.cx-n.cx)/(r.cy-n.cy))==1;(s||h||a)&&(t.splice(o,1),o--)}for(o=0;o<t.length-2;o++){for(var c=t[o],d=null,l=t.length-1;l>o+1;l--){var u=t[l];if(c.cx!=u.cx&&c.cy!=u.cy&&Math.abs(u.cx-c.cx)!=Math.abs(u.cy-c.cy)&&this.isArriveBetweenTwoNodes(c,u)){d=u;break}}if(d){var p=l-o-1;t.splice(o+1,p)}}return t},t.prototype.isArriveBetweenTwoNodes=function(t,e){if(t==e)return!1;var o=Math.abs(e.cx-t.cx),i=Math.abs(e.cy-t.cy),n=0;e.cx>t.cx?n=1:e.cx<t.cx&&(n=-1);var r=0;e.cy>t.cy?r=1:e.cy<t.cy&&(r=-1);var s=0,h=0,a=0,c=0;if(o>i)for(var d=i/o,l=0;l<o;l++){h=t.cy+l*r*d,a=Math.floor(h),c=h%1;var u=t.cx+l*n,p=c<=.5?a:a+1;h=t.cy+(l+1)*r*d,a=Math.floor(h),c=h%1;var f=t.cx+(l+1)*n,y=c<=.5?a:a+1,_=this._roadNodes[u+"_"+p],g=this._roadNodes[f+"_"+y];if(!this.isCrossAtAdjacentNodes(_,g))return!1}else for(d=o/i,l=0;l<i;l++)if(s=l*n*d,a=n>0?Math.floor(t.cx+s):Math.ceil(t.cx+s),u=(c=Math.abs(s%1))<=.5?a:a+1*n,p=t.cy+l*r,s=(l+1)*n*d,a=n>0?Math.floor(t.cx+s):Math.ceil(t.cx+s),f=(c=Math.abs(s%1))<=.5?a:a+1*n,y=t.cy+(l+1)*r,_=this._roadNodes[u+"_"+p],g=this._roadNodes[f+"_"+y],!this.isCrossAtAdjacentNodes(_,g))return!1;return!0},t.prototype.isCrossAtAdjacentNodes=function(t,e){if(t==e)return!1;if(!this.isPassNode(t)||!this.isPassNode(e))return!1;var o=e.cx-t.cx,i=e.cy-t.cy;return!(Math.abs(o)>1||Math.abs(i)>1||t.cx!=e.cx&&t.cy!=e.cy&&(!this.isPassNode(this._roadNodes[t.cx+"_"+(t.cy+i)])||!this.isPassNode(this._roadNodes[t.cx+o+"_"+t.cy])))},t.prototype.isPassNode=function(t){return!(!t||1==t.value)},t.prototype.testSeekPathStep=function(t,e,o,i,n){var r=this;if(void 0===n&&(n=100),this._startNode=t,this._currentNode=t,this._targetNode=e,1!=this._targetNode.value){this._openlist=[],this._closelist=[];var s=0;clearInterval(this.handle),this.handle=setInterval((function(){return s>r.maxStep?(console.log("没找到目标计算步骤为：",s),void clearInterval(r.handle)):(s++,r.searchRoundNodes(r._currentNode),0==r._openlist.length?(console.log("没找到目标计算步骤为：",s),void clearInterval(r.handle)):(r._openlist.sort(r.sortNode),r._currentNode=r._openlist.shift(),void(r._currentNode==r._targetNode?(console.log("找到目标计算步骤为：",s),clearInterval(r.handle),o.apply(i,[r._startNode,r._targetNode,r._currentNode,r._openlist,r._closelist,r.getPath()])):(r._closelist.push(r._currentNode),o.apply(i,[r._startNode,r._targetNode,r._currentNode,r._openlist,r._closelist,null])))))}),n)}},t.prototype.searchRoundNodes=function(t){for(var e=0;e<this._round.length;e++){var o=t.cx+this._round[e][0],i=t.cy+this._round[e][1],n=this._roadNodes[o+"_"+i];null==n||n==this._startNode||1==n.value||this.isInCloseList(n)||this.isInOpenList(n)||this.inInCorner(n)||this.setNodeF(n)}},t.prototype.setNodeF=function(t){var e;e=t.cx==this._currentNode.cx||t.cy==this._currentNode.cy?this._currentNode.g+this.COST_STRAIGHT:this._currentNode.g+this.COST_DIAGONAL,t.g=e,t.parent=this._currentNode,t.h=(Math.abs(this._targetNode.cx-t.cx)+Math.abs(this._targetNode.cy-t.cy))*this.COST_STRAIGHT,t.f=t.g+t.h,this._openlist.push(t)},t.prototype.isInOpenList=function(t){return-1!=this._openlist.indexOf(t)},t.prototype.isInCloseList=function(t){return-1!=this._closelist.indexOf(t)},t.prototype.inInCorner=function(t){if(t.cx==this._currentNode.cx||t.cy==this._currentNode.cy)return!1;var e=this._roadNodes[this._currentNode.cx+"_"+t.cy],o=this._roadNodes[t.cx+"_"+this._currentNode.cy];return!this.isPassNode(e)||!this.isPassNode(o)},t.prototype.dispose=function(){this._roadNodes=null,this._round=null},t}();var h,a=(h=function(t,e){return h=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},h(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=t}h(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});console.log("mapdata6:",t);const c=function(e){function o(){var t=e.call(this)||this;return t._roadDic={},t.init(),t}return a(o,e),o.prototype.init=function(){var e=this,o=null,i=new PIXI.Container;this.addChild(i),i.interactive=!0,i.on("pointerdown",(function(t){o={x:t.data.global.x,y:t.data.global.y}})),i.on("pointerup",(function(t){if(o){var r=o.x,s=o.y,h={x:t.data.global.x,y:t.data.global.y},a=h.x,c=h.y;if(Math.sqrt((a-r)*(a-r)+(c-s)*(c-s))<1){var d=t.data.getLocalPosition(i.parent),l=d.x,u=d.y,p=n.instance.getWorldPointByPixel(e.player.x,e.player.y),f=n.instance.getWorldPointByPixel(l,u),y=e._roadDic[p.x+"_"+p.y],_=e._roadDic[f.x+"_"+f.y],g=e._roadSeeker.seekPath2(y,_);console.log(g);var x=window.TweenMax.getTweensOf(e.player);x&&x.length&&x[0].kill(),e.roadNodeArr=g,e.move()}}o=null})),this.player=PIXI.Sprite.from("static/assets/bunny.png"),this.addChild(this.player),this.player.x=50,this.player.y=25,this.player.anchor.set(.5),n.instance.updateMapInfo(t.mapWidth,t.mapHeight,t.nodeWidth,t.nodeHeight,t.type);for(var r=t.roadDataArr.length,h=t.roadDataArr[0].length,a=0,c=0;c<r;c++)for(var l=0;l<h;l++){a=t.roadDataArr[c][l];var u=n.instance.getNodeByDerect(l,c);if(u.value=a,this._roadDic[u.cx+"_"+u.cy]=u,c<20&&l<200){var p=new d(u);i.addChild(p)}}this._roadSeeker=new s(this._roadDic),console.log(this.getGridByPixel(50,25)),console.log(this.getGridByPixel(150,25)),console.log(this.getGridByPixel(250,25))},o.prototype.getGridByPixel=function(e,o){var i=t.roadDataArr[0].length-1;return{x:Math.ceil(e/100-.5+o/50)-1,y:i-Math.ceil(e/100-.5-o/50)}},o.prototype.move=function(){if(this.roadNodeArr&&this.roadNodeArr.length>0){var t=this.roadNodeArr.shift();console.log(t.toString());var e=Math.abs(this.player.x-t.px),o=Math.abs(this.player.y-t.py),i=Math.sqrt(e*e+o*o)/100*1;window.TweenMax.to(this.player,i,{x:t.px,y:t.py,ease:window.Power0.easeNone,onComplete:this.move.bind(this)})}},o}(PIXI.Container);var d=function(e){function o(o){var i=e.call(this)||this;i.node=o;var n=o.cx,r=o.cy,s=o.dx,h=o.dy,a=o.px,c=o.py,d=o.value;i.x=a,i.y=c;var l=t.nodeWidth,u=t.nodeHeight,p=new PIXI.Graphics;p.beginFill(0===d?0:16711680,1),p.lineStyle(1,16777215,.3),p.moveTo(-l/2,0),p.lineTo(0,-u/2),p.lineTo(l/2,0),p.lineTo(0,u/2),p.closePath(),p.endFill(),i.addChild(p);var f=new PIXI.Graphics;f.beginFill(16711680,1),f.drawCircle(0,0,2),f.endFill(),i.addChild(f);var y={fontSize:12,fill:16777215,align:"center"},_=new PIXI.Text("".concat(a,"/").concat(c),y);i.addChild(_),_.anchor.set(0,1),_.x=-l/2+7,_.y=2,_.angle=31;var g=new PIXI.Text("".concat(s,"/").concat(h),y);i.addChild(g),g.anchor.set(.5,.5),g.x=0,g.y=0,g.angle=31;var x=new PIXI.Text("".concat(n,"/").concat(r),y);return x.anchor.set(1,0),i.addChild(x),x.x=l/2-3,x.y=-3,x.angle=31,i}return a(o,e),o}(PIXI.Container),l=function(){var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},t(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function i(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(i.prototype=o.prototype,new i)}}(),u=document.documentElement.clientWidth||document.body.clientWidth,p=document.documentElement.clientHeight||document.body.clientHeight;const f=function(e){function o(t){void 0===t&&(t={});var o=e.call(this,t)||this;return o.init(),o}return l(o,e),o.prototype.init=function(){document.body.prepend(this.view);var e=new c;this.stage.addChild(e),new y({ele:e,width:t.mapWidth,height:t.mapWidth}),new _({content:e,maskWidth:u,maskHeight:p,contentWidth:t.mapWidth,contentHeight:t.mapWidth})},o}(PIXI.Application);var y=function(){function e(t){var e=(this.config=t).ele;this.ele=e,this.ele.interactive=!0,this.ele.on("pointerdown",this.onDragStart,this)}return e.prototype.onDragStart=function(t){var e=t.data.global,o=e.x,i=e.y;this.dragging=!0,this.offset={x:this.ele.x-o,y:this.ele.y-i},this.ele.on("pointerup",this.onDragEnd,this),this.ele.on("pointerupoutside",this.onDragEnd,this),this.ele.on("pointermove",this.onDragMove,this)},e.prototype.onDragEnd=function(){this.dragging=!1,this.offset=null,this.ele.off("pointerup",this.onDragEnd,this).off("pointerupoutside",this.onDragEnd,this).off("pointermove",this.onDragMove,this)},e.prototype.onDragMove=function(e){if(this.dragging){var o=e.data.global,i=o.x,n=o.y,r=i+this.offset.x;r=r>=0?0:r<=-(t.mapWidth*this.ele.scale.x-u)?-(t.mapWidth*this.ele.scale.x-u):r;var s=n+this.offset.y;s=s>=0?0:s<=-(t.mapHeight*this.ele.scale.y-p)?-(t.mapHeight*this.ele.scale.y-p):s,this.ele.x=r,this.ele.y=s}},e}(),_=function(){function t(t){var e=this._options=t,o=e.content,i=e.maskWidth,n=e.maskHeight,r=e.contentWidth,s=e.contentHeight;this._content=o,this._maskWidth=i,this._maskHeight=n,this._contentWidth=r,this._contentHeight=s,this._deceleration=.001,this._content.on("pointerdown",this.onPointerDownListener,this)}return t.prototype.onPointerDownListener=function(){var t=window.TweenMax.getTweensOf(this._content);t.length&&t[0].kill(),this._start={time:(new Date).getTime(),x:this._content.x,y:this._content.y},this._content.on("pointerup",this.onPointerUpListener,this),this._content.on("pointerout",this.onPointerOutListener,this)},t.prototype.onPointerUpListener=function(){if(this._start){var t=(new Date).getTime()-this._start.time,e=this.momentum(this._content.x,this._start.x,t,this.maxScrollLeft,0,this._deceleration),o=this.momentum(this._content.y,this._start.y,t,this.maxScrollTop,0,this._deceleration),i=e.destination,n=o.destination,r=Math.max(e.duration,o.duration),s={x:i,y:n,ease:window.Power2.easeOut,onUpdate:function(){},onComplete:function(){}};window.TweenMax.to(this._content,r/1e3,s)}this._content.off("pointerup",this.onPointerUpListener,this),this._content.off("pointerout",this.onPointerOutListener,this)},t.prototype.onPointerOutListener=function(){this.onPointerUpListener()},t.prototype.momentum=function(t,e,o,i,n,r){void 0===r&&(r=6e-4);var s,h,a,c=t-e,d=Math.abs(c)/o;return h=d/r,(s=t+(d*(a=(0-d)/r)+.5*r*a*a)*(c>0?-1:1))<i?(s=n?i-n/2.5*(d/8):i,h=(c=Math.abs(s-t))/d):s>0&&(s=n?n/2.5*(d/8):0,h=(c=Math.abs(t)+s)/d),{destination:Math.round(s),duration:h}},Object.defineProperty(t.prototype,"contentWidth",{set:function(t){this._contentWidth=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"contentHeight",{set:function(t){this._contentHeight=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"maxScrollLeft",{get:function(){return this._maskWidth-this._contentWidth},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"maxScrollTop",{get:function(){return this._maskHeight-this._contentHeight},enumerable:!1,configurable:!0}),t}();new f({width:document.documentElement.clientWidth||document.body.clientWidth,height:document.documentElement.clientHeight||document.body.clientHeight,backgroundColor:13421772})})();